<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Маршрут на Эверест</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
    }
    #canvas {
      display: block;
      background-image: url('Everest-3D-Map-Type-EN.jpg');
      background-size: cover;
      width: 100vw;
      height: 100vh;
      cursor: crosshair;
    }
    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.6);
      padding: 12px;
      border-radius: 10px;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #00bcd4;
      color: white;
    }
    button:hover {
      background: #008ba3;
    }
    #result {
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="controls">
    <button onclick="checkRoute()">Проверить маршрут</button>
    <button onclick="showReference()">Посмотреть эталон</button>
    <button onclick="resetCanvas()">Начать заново</button>
    <div id="result">Рисуйте маршрут от базового лагеря до вершины </div>
  </div>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const originalWidth = 5000;
    const originalHeight = 2813;
    const scaleX = canvas.width / originalWidth;
    const scaleY = canvas.height / originalHeight;

    let drawing = false;
    let userPath = [];
    let referenceVisible = false;

    const referencePath = [[2479, 2394],
  [2479, 2391],
  [2479, 2388],
  [2476, 2388],
  [2476, 2385],
  [2473, 2382],
  [2470, 2382],
  [2466, 2378],
  [2463, 2375],
  [2463, 2372],
  [2460, 2372],
  [2457, 2372],
  [2454, 2372],
  [2454, 2369],
  [2450, 2369],
  [2447, 2369],
  [2444, 2366],
  [2441, 2366],
  [2438, 2366],
  [2434, 2366],
  [2434, 2359],
  [2431, 2359],
  [2431, 2356],
  [2428, 2356],
  [2428, 2353],
  [2425, 2353],
  [2422, 2353],
  [2422, 2350],
  [2418, 2350],
  [2415, 2350],
  [2412, 2346],
  [2412, 2343],
  [2409, 2343],
  [2409, 2340],
  [2406, 2340],
  [2402, 2340],
  [2402, 2337],
  [2399, 2334],
  [2396, 2330],
  [2396, 2327],
  [2393, 2327],
  [2393, 2324],
  [2390, 2324],
  [2390, 2321],
  [2390, 2318],
  [2386, 2318],
  [2383, 2318],
  [2383, 2314],
  [2380, 2314],
  [2380, 2311],
  [2380, 2308],
  [2377, 2308],
  [2374, 2302],
  [2374, 2298],
  [2370, 2298],
  [2370, 2295],
  [2370, 2292],
  [2367, 2292],
  [2367, 2289],
  [2367, 2286],
  [2364, 2286],
  [2364, 2279],
  [2364, 2276],
  [2361, 2276],
  [2361, 2273],
  [2358, 2273],
  [2358, 2270],
  [2358, 2266],
  [2354, 2266],
  [2354, 2263],
  [2354, 2260],
  [2354, 2257],
  [2354, 2250],
  [2351, 2250],
  [2351, 2247],
  [2348, 2247],
  [2348, 2244],
  [2348, 2241],
  [2348, 2238],
  [2348, 2234],
  [2348, 2231],
  [2348, 2228],
  [2348, 2225],
  [2348, 2222],
  [2348, 2218],
  [2348, 2215],
  [2348, 2212],
  [2348, 2209],
  [2348, 2206],
  [2348, 2202],
  [2348, 2199],
  [2348, 2196],
  [2348, 2193],
  [2348, 2190],
  [2348, 2186],
  [2348, 2183],
  [2348, 2180],
  [2348, 2177],
  [2351, 2177],
  [2351, 2174],
  [2354, 2174],
  [2354, 2170],
  [2354, 2167],
  [2354, 2164],
  [2358, 2164],
  [2358, 2161],
  [2358, 2158],
  [2361, 2158],
  [2361, 2154],
  [2361, 2151],
  [2364, 2151],
  [2364, 2148],
  [2367, 2145],
  [2367, 2142],
  [2370, 2142],
  [2370, 2138],
  [2374, 2135],
  [2374, 2132],
  [2374, 2129],
  [2377, 2129],
  [2377, 2126],
  [2377, 2122],
  [2380, 2122],
  [2383, 2119],
  [2383, 2116],
  [2383, 2113],
  [2386, 2113],
  [2386, 2110],
  [2390, 2110],
  [2390, 2106],
  [2390, 2103],
  [2393, 2103],
  [2393, 2100],
  [2393, 2097],
  [2393, 2094],
  [2396, 2094],
  [2399, 2094],
  [2399, 2090],
  [2402, 2087],
  [2402, 2084],
  [2406, 2084],
  [2409, 2078],
  [2409, 2074],
  [2412, 2071],
  [2415, 2071],
  [2415, 2068],
  [2418, 2065],
  [2418, 2062],
  [2422, 2062],
  [2425, 2058],
  [2425, 2055],
  [2425, 2052],
  [2428, 2049],
  [2431, 2046],
  [2434, 2042],
  [2438, 2039],
  [2441, 2039],
  [2441, 2036],
  [2444, 2036],
  [2444, 2033],
  [2447, 2033],
  [2447, 2030],
  [2447, 2026],
  [2454, 2023],
  [2457, 2023],
  [2457, 2020],
  [2457, 2017],
  [2460, 2017],
  [2463, 2017],
  [2463, 2014],
  [2463, 2010],
  [2466, 2007],
  [2470, 2007],
  [2470, 2004],
  [2473, 2001],
  [2476, 2001],
  [2479, 1998],
  [2479, 1994],
  [2482, 1991],
  [2486, 1991],
  [2489, 1991],
  [2489, 1988],
  [2492, 1985],
  [2495, 1982],
  [2495, 1978],
  [2498, 1975],
  [2502, 1975],
  [2502, 1972],
  [2505, 1969],
  [2508, 1969],
  [2511, 1966],
  [2511, 1962],
  [2514, 1959],
  [2518, 1959],
  [2518, 1956],
  [2524, 1953],
  [2527, 1953],
  [2527, 1946],
  [2530, 1946],
  [2534, 1943],
  [2534, 1940],
  [2537, 1937],
  [2540, 1937],
  [2540, 1934],
  [2543, 1934],
  [2543, 1930],
  [2546, 1927],
  [2550, 1921],
  [2553, 1921],
  [2553, 1918],
  [2556, 1918],
  [2559, 1911],
  [2562, 1911],
  [2562, 1908],
  [2566, 1908],
  [2566, 1905],
  [2566, 1902],
  [2569, 1902],
  [2569, 1898],
  [2572, 1895],
  [2575, 1895],
  [2575, 1892],
  [2575, 1889],
  [2578, 1889],
  [2582, 1886],
  [2582, 1882],
  [2582, 1879],
  [2585, 1879],
  [2585, 1876],
  [2591, 1876],
  [2591, 1873],
  [2591, 1870],
  [2594, 1866],
  [2594, 1863],
  [2598, 1863],
  [2601, 1857],
  [2604, 1857],
  [2607, 1850],
  [2607, 1847],
  [2614, 1844],
  [2614, 1841],
  [2620, 1841],
  [2623, 1834],
  [2626, 1834],
  [2630, 1825],
  [2633, 1825],
  [2636, 1822],
  [2636, 1818],
  [2642, 1812],
  [2646, 1809],
  [2646, 1806],
  [2649, 1802],
  [2652, 1799],
  [2652, 1796],
  [2655, 1793],
  [2658, 1793],
  [2662, 1786],
  [2665, 1786],
  [2665, 1783],
  [2668, 1777],
  [2671, 1770],
  [2674, 1770],
  [2674, 1767],
  [2678, 1764],
  [2678, 1761],
  [2681, 1758],
  [2684, 1754],
  [2687, 1751],
  [2690, 1745],
  [2694, 1742],
  [2694, 1735],
  [2700, 1735],
  [2700, 1732],
  [2703, 1726],
  [2710, 1726],
  [2710, 1719],
  [2713, 1716],
  [2716, 1713],
  [2719, 1713],
  [2719, 1706],
  [2722, 1703],
  [2726, 1700],
  [2729, 1697],
  [2732, 1697],
  [2732, 1690],
  [2735, 1687],
  [2742, 1684],
  [2742, 1681],
  [2745, 1678],
  [2745, 1674],
  [2748, 1671],
  [2751, 1668],
  [2754, 1668],
  [2754, 1665],
  [2758, 1665],
  [2764, 1658],
  [2764, 1655],
  [2770, 1655],
  [2770, 1649],
  [2774, 1649],
  [2777, 1646],
  [2780, 1646],
  [2783, 1639],
  [2786, 1639],
  [2790, 1636],
  [2793, 1633],
  [2793, 1630],
  [2796, 1630],
  [2799, 1623],
  [2802, 1623],
  [2806, 1620],
  [2809, 1617],
  [2812, 1614],
  [2812, 1610],
  [2815, 1610],
  [2815, 1607],
  [2818, 1607],
  [2818, 1601],
  [2818, 1598],
  [2825, 1598],
  [2825, 1594],
  [2825, 1591],
  [2828, 1591],
  [2828, 1588],
  [2828, 1585],
  [2828, 1582],
  [2828, 1578],
  [2831, 1578],
  [2831, 1575],
  [2834, 1575],
  [2834, 1572],
  [2834, 1569],
  [2834, 1566],
  [2834, 1562],
  [2834, 1559],
  [2834, 1556],
  [2838, 1550],
  [2841, 1543],
  [2841, 1540],
  [2841, 1537],
  [2841, 1534],
  [2844, 1530],
  [2844, 1527],
  [2844, 1524],
  [2844, 1521],
  [2844, 1518],
  [2844, 1514],
  [2844, 1511],
  [2844, 1508],
  [2844, 1505],
  [2844, 1502],
  [2844, 1498],
  [2844, 1495],
  [2844, 1492],
  [2844, 1489],
  [2844, 1486],
  [2844, 1482],
  [2844, 1479],
  [2844, 1473],
  [2844, 1470],
  [2844, 1463],
  [2844, 1460],
  [2844, 1454],
  [2844, 1450],
  [2844, 1447],
  [2844, 1444],
  [2844, 1441],
  [2844, 1438],
  [2844, 1434],
  [2844, 1431],
  [2844, 1428],
  [2844, 1425],
  [2844, 1422],
  [2844, 1418],
  [2844, 1415],
  [2844, 1412],
  [2844, 1409],
  [2844, 1406],
  [2844, 1402],
  [2844, 1399],
  [2844, 1396],
  [2844, 1393],
  [2844, 1390],
  [2844, 1386],
  [2844, 1383],
  [2844, 1380],
  [2844, 1374],
  [2844, 1370],
  [2844, 1367],
  [2844, 1364],
  [2844, 1361],
  [2844, 1358],
  [2841, 1358],
  [2841, 1354],
  [2841, 1351],
  [2841, 1348],
  [2841, 1345],
  [2841, 1342],
  [2841, 1338],
  [2841, 1335],
  [2841, 1332],
  [2841, 1329],
  [2838, 1329],
  [2838, 1326],
  [2838, 1322],
  [2834, 1322],
  [2834, 1319],
  [2834, 1316],
  [2834, 1313],
  [2834, 1310],
  [2834, 1306],
  [2834, 1303],
  [2834, 1300],
  [2834, 1297],
  [2834, 1294],
  [2834, 1290],
  [2834, 1287],
  [2834, 1284],
  [2831, 1281],
  [2831, 1278],
  [2831, 1274],
  [2831, 1271],
  [2831, 1268],
  [2831, 1265],
  [2831, 1262],
  [2831, 1258],
  [2831, 1255],
  [2831, 1252],
  [2831, 1249],
  [2831, 1246],
  [2831, 1242],
  [2831, 1239],
  [2831, 1236],
  [2831, 1233],
  [2831, 1230],
  [2831, 1226],
  [2831, 1223],
  [2834, 1223],
  [2834, 1220],
  [2834, 1217],
  [2834, 1214],
  [2838, 1214],
  [2838, 1210],
  [2838, 1207],
  [2841, 1204],
  [2841, 1201],
  [2841, 1198],
  [2844, 1191],
  [2844, 1188],
  [2844, 1185],
  [2844, 1182],
  [2847, 1182],
  [2847, 1178],
  [2850, 1178],
  [2850, 1175],
  [2850, 1172],
  [2850, 1169],
  [2850, 1166],
  [2850, 1162],
  [2854, 1162],
  [2854, 1159],
  [2854, 1156],
  [2854, 1153],
  [2854, 1150],
  [2854, 1146],
  [2857, 1146],
  [2860, 1143],
  [2860, 1140],
  [2860, 1137],
  [2863, 1134],
  [2863, 1130],
  [2866, 1130],
  [2870, 1130],
  [2870, 1127],
  [2870, 1124],
  [2870, 1121],
  [2873, 1121],
  [2873, 1118],
  [2873, 1114],
  [2876, 1114],
  [2876, 1108],
  [2879, 1108],
  [2879, 1105],
  [2882, 1102],
  [2882, 1098],
  [2886, 1098],
  [2886, 1092],
  [2886, 1089],
  [2889, 1089],
  [2892, 1086],
  [2892, 1082],
  [2892, 1079],
  [2892, 1076],
  [2892, 1073],
  [2895, 1070],
  [2895, 1066],
  [2895, 1063],
  [2898, 1063],
  [2902, 1060],
  [2902, 1057],
  [2902, 1054],
  [2905, 1050],
  [2905, 1047],
  [2908, 1047],
  [2908, 1044],
  [2908, 1041],
  [2911, 1038],
  [2914, 1034],
  [2914, 1031],
  [2921, 1028],
  [2921, 1025],
  [2921, 1022],
  [2924, 1022],
  [2924, 1018],
  [2924, 1015],
  [2927, 1015],
  [2930, 1012],
  [2930, 1009],
  [2934, 1009],
  [2934, 1006],
  [2934, 1002],
  [2937, 1002],
  [2940, 1002],
  [2940, 999],
  [2943, 999],
  [2943, 996],
  [2946, 996],
  [2946, 993],
  [2950, 993],
  [2950, 990],
  [2953, 986],
  [2956, 986],
  [2956, 983],
  [2959, 983],
  [2959, 980],
  [2962, 980],
  [2966, 977],
  [2966, 974],
  [2969, 970],
  [2972, 970],
  [2972, 967],
  [2975, 967],
  [2975, 964],
  [2978, 961],
  [2982, 961],
  [2985, 958],
  [2988, 958],
  [2991, 951],
  [2994, 951],
  [2994, 948],
  [2994, 945],
  [3001, 945],
  [3001, 942],
  [3001, 938],
  [3004, 938],
  [3004, 935],
  [3007, 932],
  [3010, 929],
  [3010, 926],
  [3014, 926],
  [3014, 922],
  [3017, 919],
  [3020, 919],
  [3020, 916],
  [3023, 913],
  [3023, 910],
  [3026, 910],
  [3030, 906],
  [3030, 903],
  [3030, 900],
  [3030, 897],
  [3033, 897],
  [3036, 890],
  [3039, 887],
  [3042, 884],
  [3042, 881],
  [3046, 881],
  [3046, 878],
  [3049, 871],
  [3052, 871],
  [3052, 868],
  [3052, 865],
  [3055, 865],
  [3055, 862],
  [3055, 858],
  [3058, 855],
  [3062, 855],
  [3062, 852],
  [3065, 852],
  [3068, 852],
  [3068, 849],
  [3068, 846],
  [3071, 846],
  [3071, 842],
  [3074, 839],
  [3078, 839],
  [3078, 836],
  [3078, 833],
  [3081, 833],
  [3081, 830],
  [3084, 830],
  [3084, 826],
  [3084, 823],
  [3084, 820],
  [3084, 817],
  [3087, 817],
  [3090, 817],
  [3090, 814],
  [3090, 810],
  [3094, 810],
  [3094, 807],
  [3094, 804],
  [3097, 801],
  [3100, 794],
  [3100, 791],
  [3100, 788],
  [3100, 785],
  [3103, 785],
  [3103, 782],
  [3106, 775],
  [3110, 772],
  [3110, 769],
  [3110, 766],
  [3110, 762],
  [3113, 759],
  [3113, 756],
  [3116, 756],
  [3116, 753],
  [3116, 750],
  [3116, 746],
  [3116, 743],
  [3116, 740],
  [3116, 737],
  [3116, 734],
  [3116, 730],
  [3116, 727],
  [3116, 724],
  [3116, 721],
  [3116, 718],
  [3116, 714],
  [3113, 714],
  [3113, 711],
  [3110, 711],
  [3106, 711],
  [3103, 711],
  [3103, 708],
  [3103, 705],
  [3100, 705],
  [3097, 705],
  [3094, 705],
  [3090, 705],
  [3087, 705],
  [3084, 705],
  [3081, 705],
  [3078, 702],
  [3074, 702],
  [3071, 702],
  [3065, 702],
  [3062, 702],
  [3058, 702],
  [3055, 702],
  [3055, 698],
  [3052, 698],
  [3049, 698],
  [3046, 698],
  [3042, 698],
  [3039, 698],
  [3036, 698],
  [3033, 698],
  [3030, 698],
  [3026, 698],
  [3026, 695],
  [3020, 695],
  [3017, 695],
  [3010, 692],
  [3007, 689],
  [3004, 689],
  [3001, 689],
  [2998, 689],
  [2994, 689],
  [2994, 686],
  [2991, 686],
  [2991, 682],
  [2988, 682],
  [2985, 682],
  [2982, 682],
  [2978, 679],
  [2975, 676],
  [2972, 676],
  [2969, 676],
  [2969, 673],
  [2966, 673],
  [2962, 673],
  [2962, 670],
  [2959, 670],
  [2956, 670],
  [2956, 666],
  [2953, 666],
  [2950, 666],
  [2950, 663],
  [2946, 663],
  [2946, 660],
  [2943, 657],
  [2940, 657],
  [2937, 657],
  [2930, 654],
  [2930, 650],
  [2927, 650],
  [2924, 650],
  [2921, 650],
  [2921, 647],
  [2921, 644],
  [2914, 644],
  [2914, 641],
  [2911, 641],
  [2908, 634],
  [2905, 634],
  [2902, 631],
  [2898, 631],
  [2895, 631],
  [2895, 628],
  [2895, 625],
  [2892, 625],
  [2889, 622],
  [2886, 622],
  [2882, 618],
  [2882, 615],
  [2879, 615],
  [2876, 615],
  [2873, 612],
  [2870, 612],
  [2866, 612],
  [2866, 609],
  [2863, 609],
  [2860, 609],
  [2857, 609],
  [2850, 609],
  [2847, 609],
  [2841, 609],
  [2834, 609],
  [2831, 609],
  [2828, 609],
  [2822, 609],
  [2818, 609],
  [2812, 609],
  [2806, 609],
  [2802, 609],
  [2796, 609],
  [2790, 606],
  [2786, 606],
  [2783, 606],
  [2780, 606],
  [2777, 606],
  [2770, 606],
  [2767, 606],
  [2761, 606],
  [2761, 602],
  [2758, 602],
  [2754, 602],
  [2751, 602],
  [2748, 602],
  [2745, 602],
  [2738, 602],
  [2735, 602],
  [2729, 602],
  [2726, 602],
  [2722, 602],
  [2719, 602],
  [2716, 602],
  [2710, 602],
  [2706, 602],
  [2703, 602],
  [2700, 602],
  [2697, 602],
  [2694, 602],
  [2690, 602],
  [2687, 602],
  [2684, 599],
  [2681, 599],
  [2678, 599],
  [2674, 599],
  [2674, 596],
  [2671, 596],
  [2668, 593],
  [2665, 593],
  [2662, 590],
  [2658, 590],
  [2658, 586],
  [2655, 583],
  [2652, 583],
  [2652, 580],
  [2646, 580],
  [2642, 577],
  [2642, 574],
  [2639, 567],
  [2636, 567],
  [2636, 564],
  [2633, 564],
  [2630, 561],
  [2626, 561],
  [2626, 558],
  [2626, 554],
  [2623, 554],
  [2620, 554],
  [2617, 554],
  [2617, 551],
  [2614, 551],
  [2610, 551],
  [2610, 548],
  [2610, 545],
  [2607, 545],
  [2604, 545],
  [2601, 542],
  [2601, 538],
  [2598, 538],
  [2598, 535],
  [2594, 535],
  [2594, 529],
  [2588, 529],
  [2588, 526],
  [2585, 522],
  [2582, 519],
  [2578, 519],
  [2578, 516],
  [2578, 513],
  [2575, 513],
  [2572, 513],
  [2572, 510],
  [2569, 510],
  [2566, 510],
  [2562, 506],
  [2559, 506],
  [2559, 503],
  [2556, 500],
  [2553, 500],
  [2550, 497],
  [2546, 497],
  [2546, 494],
  [2543, 494],
  [2540, 494],
  [2540, 490],
  [2537, 490],
  [2534, 490],
  [2530, 490],
  [2527, 487],
  [2524, 484],
  [2518, 484],
  [2514, 481],
  [2511, 481],
  [2508, 481],
  [2505, 481],
  [2502, 481],
  [2498, 481],
  [2498, 478],
  [2492, 478],
  [2492, 474],
  [2489, 474],
  [2486, 474],
  [2482, 474],
  [2479, 471],
  [2476, 471],
  [2476, 468],
  [2473, 468],
  [2470, 468],
  [2470, 465],
  [2463, 465],
  [2460, 465],
  [2460, 462],
  [2457, 462],
  [2454, 462],
  [2454, 458],
  [2450, 458],
  [2447, 458],
  [2444, 458],
  [2441, 458],
  [2438, 458],
  [2434, 458],
  [2431, 458],
  [2428, 458],
  [2425, 455],
  [2422, 455],
  [2418, 452],
  [2415, 452],
  [2412, 449],
  [2409, 449],
  [2406, 449],
  [2406, 446],
  [2406, 442],
  [2402, 442],
  [2399, 442]
];

   const bg = new Image();
bg.src = 'Everest-3D-Map-Type-EN.jpg';
let bgLoaded = false;

bg.onload = () => {
  bgLoaded = true;
  draw();
};

function getScaledPath(path) {
  return path.map(([x, y]) => [x * scaleX, y * scaleY]);
}

function drawSmoothLine(path, color) {
  if (path.length < 2) return;
  ctx.strokeStyle = color;
  ctx.lineWidth = 4;
  ctx.lineJoin = "round";
  ctx.lineCap = "round";
  ctx.beginPath();
  ctx.moveTo(path[0][0], path[0][1]);
  for (let i = 1; i < path.length - 1; i++) {
    const midX = (path[i][0] + path[i + 1][0]) / 2;
    const midY = (path[i][1] + path[i + 1][1]) / 2;
    ctx.quadraticCurveTo(path[i][0], path[i][1], midX, midY);
  }
  ctx.stroke();
}

function drawColoredUserPath() {
  if (userPath.length < 2) return;
  const scaledRef = getScaledPath(referencePath);
  const threshold = 30;

  ctx.lineWidth = 4;
  ctx.lineJoin = "round";
  ctx.lineCap = "round";

  for (let i = 1; i < userPath.length; i++) {
    const [x1, y1] = userPath[i - 1];
    const [x2, y2] = userPath[i];
    const isClose = scaledRef.some(([rx, ry]) => {
      const dist = Math.hypot(rx - x2, ry - y2);
      return dist < threshold;
    });

    ctx.strokeStyle = isClose ? '#00bfff' : '#ff3b3b';
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }
}

function draw() {
  if (!bgLoaded) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

  drawColoredUserPath();

  if (referenceVisible) {
    drawSmoothLine(getScaledPath(referencePath), '#ffffff88');
  }
}

canvas.addEventListener("mousedown", (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  drawing = true;
  userPath.push([x, y]);
  draw();
});

canvas.addEventListener("mouseup", () => {
  drawing = false;
});

canvas.addEventListener("mousemove", (e) => {
  if (!drawing) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  userPath.push([x, y]);
  draw();
});

function distance(p1, p2) {
  return Math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2);
}

function checkRoute() {
  if (userPath.length < 10) {
    document.getElementById("result").textContent = "Слишком короткий маршрут!";
    return;
  }

  const scaledRef = getScaledPath(referencePath);
  let matchCount = 0;
  const threshold = 30;

  for (const ref of scaledRef) {
    const close = userPath.some(pt => distance(pt, ref) < threshold);
    if (close) {
      matchCount++;
    }
  }

  const percent = Math.round((matchCount / scaledRef.length) * 100);
  document.getElementById("result").textContent =
    "✔️ Совпадение маршрута: " + percent + "%";
}

function resetCanvas() {
  userPath = [];
  referenceVisible = false;
  draw();
  document.getElementById("result").textContent = "Маршрут сброшен. Рисуйте снова!";
}

function showReference() {
  referenceVisible = true;
  draw();
}
