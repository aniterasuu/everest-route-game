<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú–∞—Ä—à—Ä—É—Ç –Ω–∞ –≠–≤–µ—Ä–µ—Å—Ç</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
    }

    #canvas {
      display: block;
      background-image: url('Everest-3D-Map-Type-EN.jpg');
      background-size: cover;
      width: 100vw;
      height: 100vh;
      cursor: crosshair;
    }

    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.6);
      padding: 12px;
      border-radius: 10px;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #00bcd4;
      color: white;
    }

    button:hover {
      background: #008ba3;
    }

    #result {
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div id="controls">
    <button onclick="checkRoute()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
    <button onclick="showReference()">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ç–∞–ª–æ–Ω</button>
    <button onclick="resetCanvas()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    <div id="result">–†–∏—Å—É–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç –æ—Ç Base Camp –¥–æ –≤–µ—Ä—à–∏–Ω—ã üßó</div>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let drawing = false;
    let userPath = [];
    let referenceVisible = false;

    // –ù–æ–≤—ã–π —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç, –≤–∑—è—Ç—ã–π –ø–æ —Å–∏–Ω–µ–π –ª–∏–Ω–∏–∏ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
    const referencePath = [
      [280, 680], [300, 640], [320, 610], [340, 580], [360, 550],
      [390, 520], [420, 490], [450, 460], [480, 430], [510, 400],
      [540, 370], [570, 340], [600, 310], [640, 280], [670, 250],
      [700, 220]
    ];

    function drawSmoothLine(path, color) {
      if (path.length < 2) return;
      ctx.strokeStyle = color;
      ctx.lineWidth = 4;
      ctx.lineJoin = "round";
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(path[0][0], path[0][1]);
      for (let i = 1; i < path.length - 1; i++) {
        const midX = (path[i][0] + path[i+1][0]) / 2;
        const midY = (path[i][1] + path[i+1][1]) / 2;
        ctx.quadraticCurveTo(path[i][0], path[i][1], midX, midY);
      }
      ctx.stroke();
    }

    function draw() {
      const bg = new Image();
      bg.src = 'Everest-3D-Map-Type-EN.jpg';
      bg.onload = () => {
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
        drawSmoothLine(userPath, '#00bfff');
        if (referenceVisible) {
          drawSmoothLine(referencePath, '#ffffff88');
        }
      };
    }

    canvas.addEventListener("mousedown", (e) => {
      drawing = true;
      userPath = [];
      ctx.beginPath();
    });

    canvas.addEventListener("mouseup", () => {
      drawing = false;
    });

    canvas.addEventListener("mousemove", (e) => {
      if (!drawing) return;
      userPath.push([e.offsetX, e.offsetY]);
      draw();
    });

    function distance(p1, p2) {
      return Math.sqrt((p1[0]-p2[0])**2 + (p1[1]-p2[1])**2);
    }

    function checkRoute() {
      if (userPath.length < 10) {
        document.getElementById("result").textContent = "–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –º–∞—Ä—à—Ä—É—Ç!";
        return;
      }

      let matchCount = 0;
      const threshold = 30;

      for (const ref of referencePath) {
        const close = userPath.some(pt => distance(pt, ref) < threshold);
        if (close) {
          matchCount++;
        } else {
          ctx.beginPath();
          ctx.arc(ref[0], ref[1], 6, 0, 2 * Math.PI);
          ctx.fillStyle = "red";
          ctx.fill();
        }
      }

      const percent = Math.round((matchCount / referencePath.length) * 100);
      document.getElementById("result").textContent =
        `‚úîÔ∏è –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞: ${percent}%`;
    }

    function resetCanvas() {
      userPath = [];
      referenceVisible = false;
      draw();
      document.getElementById("result").textContent = "–ú–∞—Ä—à—Ä—É—Ç —Å–±—Ä–æ—à–µ–Ω. –†–∏—Å—É–π—Ç–µ —Å–Ω–æ–≤–∞!";
    }

    function showReference() {
      referenceVisible = true;
      draw();
    }

    draw();
  </script>
</body>
</html>
